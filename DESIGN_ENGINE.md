# Racking Design Engine — Master Plan

## Vision
Feed in a warehouse building layout → output a complete racking design (indistinguishable from a human-designed layout) → auto-generate BOM → auto-generate pricing model.

## System Architecture

### Phase 1: Knowledge Base (IN PROGRESS)
- [x] BOM formulas validated across 7 projects
- [x] Counting model architecture documented
- [x] Pricing model format locked
- [ ] Seismic/code reference complete
- [ ] Layout design rules documented
- [ ] Prologis market data compiled

### Phase 2: Layout Design Engine
Given inputs:
- Building dimensions (or floor plan PDF/CAD)
- Clear height
- Pallet size & weight
- Desired pallet positions (PP target)
- Rack type (selective, push-back, pallet flow)
- New vs used rack
- Building address (→ seismic zone lookup)

Generate:
- Optimal rack height (beam levels from clear height)
- Aisle width (from forklift type)
- Row layout (fit rows into building width)
- Bay layout (fit bays into building length)
- Column avoidance (flue spaces around building columns)
- Tunnel placement (cross-aisle access)
- Elevation types (different configs per area)
- Complete floor plan drawing

### Phase 3: Automated BOM from Layout
- Layout → counting model (auto-fill Drawing grid)
- Counting model → BOM (existing formulas)
- BOM → Pricing model (existing XLSX generator)

### Phase 4: Engineering Compliance
- Address → lat/long → USGS seismic API → SDC
- SDC → anchor requirements, bracing specs
- Clear height → fire code (high-pile threshold)
- Auto-flag: permits needed, sprinkler mods, high-pile permits

## Key Design Parameters

### From Building
- Floor plan dimensions (L × W)
- Clear height to lowest obstruction
- Column grid spacing
- Dock door locations (one side vs cross-dock)
- Sprinkler system type (ESFR, in-rack, etc.)
- Floor slab thickness & capacity

### From Address
- Seismic Design Category (SDC A-F)
- S1, Ss, SDS, SD1 values
- Local building code (IBC/CBC/other)
- Fire marshal jurisdiction
- High-pile storage requirements

### From Customer
- Pallet size (48×40 standard)
- Pallet weight (drives beam selection)
- Number of SKUs (selectivity needs)
- Throughput requirements (aisle width/type)
- Target pallet positions
- Rack type preference
- New vs used
- Budget

### Calculated
- Frame height = clear_height - 18" (sprinkler) - top_clearance
- Beam levels = (frame_height - first_beam_height) / level_spacing + 1
- Beam length from pallet size (2 pallets per bay standard)
- Aisle width from forklift type
- Row pitch = frame_depth + beam_length/2 + aisle_width/2 (for back-to-back)
- Bays per row = (building_length - end_clearances) / (beam_length + frame_width)
- Rows = (building_width - staging_depth) / row_pitch
- PP = bays × beam_levels × pallets_per_bay

## Prologis Markets (anchor data needed)

| Market | SDC | Code | Typical Clear | Notes |
|--------|-----|------|--------------|-------|
| Inland Empire, CA | D | CBC | 32-36ft | High seismic |
| Chicago, IL | A-B | IBC | 28-32ft | Low seismic |
| Dallas/DFW, TX | A-B | IBC | 32-36ft | Low seismic |
| New Jersey/PA | A-B | IBC | 28-36ft | Varies |
| Atlanta, GA | A-B | IBC | 32-36ft | Low seismic |
| Memphis, TN | C-D | IBC | 28-32ft | Near New Madrid |
| Indianapolis, IN | A-B | IBC | 28-32ft | Low seismic |
| Phoenix, AZ | B | IBC | 32-36ft | Low seismic |
| Houston, TX | A | IBC | 28-32ft | Low seismic, flood zone |
| Seattle, WA | D | IBC | 28-32ft | High seismic |

## What I Learned from Prelim Engineering Docs

### OneRack LLC Prelim Format (Spirit project)
- Generated by "OneRack" software
- Takes: project, elevation, address, coordinates
- Calculates: seismic params (S1, Ss, SDS, SD1, SDC)
- Specifies per elevation:
  - Column type (Interlake 313, 4101, etc.)
  - Front/back column utilization %
  - Beam type & utilization %
  - Connection type & utilization %
  - Brace pattern (H/D alternating) & utilization %
  - Base plate dimensions & stress
  - Slab requirements (thickness, psi)
  - Anchor spec (Hilti Kwik Bolt, size, embed depth, count per plate)
- Notes: separation from building, row spacer design

### Seizmic Inc Prelim Format (Spirit seismic analysis)
- "PRELIMINARY REPORT - Analysis per section 2209 of the 2022 CBC"
- Shows: S1, Fa, Fv, I factor, S'1, SDC
- Frame column spec, beam spec, connector spec
- Horizontal & diagonal brace specs with utilization
- Base plate, slab & soil analysis
- Anchor spec with pullout/shear capacity
- V_long and V_trans (seismic base shear values)

### Key Engineering Insight: ANCHORS
- OneRack Spirit (Perris CA, SDC:D): 4 anchors per base plate, Hilti Kwik Bolt TZ2, 0.625" dia × embed 3.75"
- Seizmic Spirit (Bloomington CA, SDC:D): 4 anchors per plate, same Hilti KB-TZ2
- So "8 anchors per frame" = 4 per base plate × 2 base plates per frame
- "2 anchors per frame" = 1 per base plate × 2 base plates
- The PRELIM ENGINEERING REPORT determines anchor count!

## Implementation Priority
1. Deep knowledge base (research + document)
2. Seismic lookup API integration (USGS)
3. Layout algorithm (building → row/bay placement)
4. Layout visualization (SVG/Canvas output)
5. Full pipeline: building → layout → BOM → pricing
